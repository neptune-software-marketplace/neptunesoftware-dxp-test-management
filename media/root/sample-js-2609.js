data:text/javascript;base64,bmFiLmJyYW5kaW5nID0gew0KICAgIGZpc3RUaW1lOiB0cnVlLA0KICAgIGV2ZW50Q2xpY2tJbml0ZWQ6IGZhbHNlLA0KICAgIG9wZW5Qb3BGb2xkZXJOYW1lOiBmYWxzZSwNCiAgICBjdXJyZW50Rm9sZGVyOiB7fSwNCiAgICBzZWxlY3RlZE9iamVjdDoge30sDQogICAgc2VsZWN0ZWRPYmplY3RJc0FIZWFkZXI6IGZhbHNlLA0KICAgIGZvcm1PcHRpb25zOiBbDQogICAgICAgIHsga2V5OiAiQ29sb3JzL2NvbG9yMSIsIGxhYmVsOiAiUHJpbWFyeSBDb2xvciAxIiB9LA0KICAgICAgICB7IGtleTogIkNvbG9ycy9jb2xvcjIiLCBsYWJlbDogIlByaW1hcnkgQ29sb3IgMiIgfSwNCiAgICAgICAgeyBrZXk6ICJDb2xvcnMvY29sb3IzIiwgbGFiZWw6ICJTZWNvbmRhcnkgQ29sb3IgMSIgfSwNCiAgICAgICAgeyBrZXk6ICJDb2xvcnMvY29sb3I0IiwgbGFiZWw6ICJTZWNvbmRhcnkgQ29sb3IgMiIgfSwNCiAgICAgICAgeyBrZXk6ICJDb2xvcnMvY29sb3I1IiwgbGFiZWw6ICJTZWNvbmRhcnkgQ29sb3IgMyIgfSwNCg0KICAgICAgICAvLyB7IGtleTogInBhZ2VCR0NvbG9yIiwgbGFiZWw6ICJQYWdlIEJhY2tncm91bmQiIH0sDQogICAgICAgIC8vIHsga2V5OiAicGFnZUhlYWRlckNvbG9yIiwgbGFiZWw6ICJQYWdlIEhlYWRlciIgfSwNCiAgICAgICAgLy8geyBrZXk6ICJwYWdlRm9vdGVyQ29sb3IiLCBsYWJlbDogIlBhZ2UgRm9vdGVyIiB9LA0KICAgICAgICAvLyB7IGtleTogInRleHRDb2xvciIsIGxhYmVsOiAiVGV4dCIgfSwNCiAgICAgICAgLy8geyBrZXk6ICJ0ZXh0VGl0bGVDb2xvciIsIGxhYmVsOiAiVGl0bGUiIH0sDQogICAgICAgIC8vIHsga2V5OiAiTGlzdFRpdGxlQ29sb3IiLCBsYWJlbDogIkxpc3QgLSBUaXRsZSIgfSwNCiAgICAgICAgLy8geyBrZXk6ICJMaXN0SW50cm9Db2xvciIsIGxhYmVsOiAiTGlzdCAtIEludHJvIiB9LA0KICAgICAgICAvLyB7IGtleTogIkxpc3RJY29uQ29sb3IiLCBsYWJlbDogIkxpc3QgLSBJY29uIiB9LA0KICAgIF0sDQoNCiAgICBpbml0OiBmdW5jdGlvbiAoYWNjb3VudElkKSB7DQogICAgICAgIG9UcmVlQnJhbmRpbmcuZ2V0QmluZGluZygpLm1QYXJhbWV0ZXJzID0geyBhcnJheU5hbWVzOiBbJ3N1YkZvbGRlciddIH07DQogICAgICAgIGlmIChuYWIuYnJhbmRpbmcuZmlzdFRpbWUpIHsNCiAgICAgICAgICAgIG5hYi5icmFuZGluZy5maXN0VGltZSA9IGZhbHNlOw0KICAgICAgICAgICAgbmFiLmJyYW5kaW5nLmNyZWF0ZUZvcm0oKTsNCg0KICAgICAgICAgICAgYm9QYWdlUHJldmlld0JyYW5kaW5nLmFkZEV2ZW50RGVsZWdhdGUoeyAvLyBEWFBQLTEzMg0KICAgICAgICAgICAgICAgIG9uQWZ0ZXJSZW5kZXJpbmc6IGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICAgICAgICAgIC8vaWYgKCFuYWIuYnJhbmRpbmcuZXZlbnRDbGlja0luaXRlZCkgew0KICAgICAgICAgICAgICAgICAgICBuYWIuYnJhbmRpbmcuZXZlbnRDbGlja0luaXRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIGJvUGFnZVByZXZpZXdCcmFuZGluZy5nZXREb21SZWYoKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG5hYi5icmFuZGluZy5wYWdlQ2xpY2spDQogICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coZS50YXJnZXQuaWQpDQogICAgICAgICAgICAgICAgICAgIC8vIH0pDQogICAgICAgICAgICAgICAgICAgIC8vIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KQ0KICAgICAgICB9DQoNCiAgICAgICAgYXBpQnJhbmRpbmdHZXQoew0KICAgICAgICAgICAgcGFyYW1ldGVyczogew0KICAgICAgICAgICAgICAgICJhY2NvdW50aWQiOiBhY2NvdW50SWQNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkgew0KICAgICAgICAgICAgbmFiLmJyYW5kaW5nLnByb2Nlc3NpbmdEYXRhKGRhdGEpOw0KICAgICAgICB9KTsNCiAgICB9LA0KICAgIHByb2Nlc3NpbmdEYXRhOiBmdW5jdGlvbiAoZGF0YSkgew0KICAgICAgICBuYWIuYnJhbmRpbmcuY2hlY2tJRkFwcEFzQ3NzRGVmaW5lZChkYXRhKQ0KICAgICAgICBuYWIuYnJhbmRpbmcuYnVpbGRUcmVlKGRhdGEpDQogICAgfSwNCiAgICBjaGVja0lGQXBwQXNDc3NEZWZpbmVkOiBmdW5jdGlvbiAoZGF0YSkgew0KDQogICAgICAgIGlmIChtb2RlbEFwcERhdGEub0RhdGEucGFnZXMgIT09IHVuZGVmaW5lZCAmJiBtb2RlbEFwcERhdGEub0RhdGEucGFnZXMubGVuZ3RoID4gMCAmJiBtb2RlbEFwcERhdGEub0RhdGEucGFnZXNbMF0uY3NzICE9PSBudWxsICYmIG1vZGVsQXBwRGF0YS5vRGF0YS5wYWdlc1swXS5jc3MubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgbGV0IGNzcyA9IG1vZGVsQXBwRGF0YS5vRGF0YS5wYWdlc1swXS5jc3MuZmluZChhID0+IGEuY29tcG9uZW50TmFtZSA9PT0gIkFCUkJyYW5kaW5nIikNCiAgICAgICAgICAgIGlmIChjc3MpIHsNCiAgICAgICAgICAgICAgICBpZiAobW9kZWxCcmFuZGluZy5vRGF0YS5sZW5ndGggIT09IHVuZGVmaW5lZCkgeyAvLyBpZiBtb2RlbCBpcyBpbmljaWFsIHdlIHdpbGwgaGF2ZSBhIEpTIEVycm9yDQogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBkYXRhKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGluZS5pZCA9PT0gY3NzLmNzc0lkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZS51c2VkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZS51c2VkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBkYXRhKSB7DQogICAgICAgICAgICAgICAgICAgIGxpbmUudXNlZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBtb2RlbEJyYW5kaW5nLm9EYXRhID0gZGF0YTsNCiAgICAgICAgbW9kZWxCcmFuZGluZy5yZWZyZXNoKCk7DQoNCiAgICB9LA0KICAgIGNyZWF0ZUZvcm06IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgJC5lYWNoKG5hYi5icmFuZGluZy5mb3JtT3B0aW9ucywgZnVuY3Rpb24gKGksIGZvcm1MaW5lKSB7DQogICAgICAgICAgICBsZXQgbGFiZWwgPSBuZXcgc2FwLm0uTGFiZWwoeyB0ZXh0OiBmb3JtTGluZS5sYWJlbCB9KTsNCiAgICAgICAgICAgIG9TaW1wbGVGb3JtQnJhbmRpbmcuYWRkQ29udGVudChsYWJlbCk7DQoNCiAgICAgICAgICAgIGxldCBpY29uID0gbmV3IHNhcC51aS5jb3JlLkljb24oew0KICAgICAgICAgICAgICAgIHNyYzogInNhcC1pY29uOi8vZmEtc29saWQvc3F1YXJlIiwNCiAgICAgICAgICAgICAgICBzaXplOiAiMS41cmVtIiwNCiAgICAgICAgICAgICAgICBjb2xvcjogInsvIiArIGZvcm1MaW5lLmtleSArICJ9IiwNCiAgICAgICAgICAgICAgICBwcmVzczogZnVuY3Rpb24gKG9FdmVudCkgew0KICAgICAgICAgICAgICAgICAgICBvUmVzcG9uc2l2ZVBvcG92ZXJCcmFuZGluZy5vcGVuQnkodGhpcykNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgaWNvbi5hZGRTdHlsZUNsYXNzKCJuYWJCcmFuZGluZ1NGIik7DQogICAgICAgICAgICBpY29uLmFkZFN0eWxlQ2xhc3MoInNhcFVpVGlueU1hcmdpblRvcCIpOw0KICAgICAgICAgICAgb1NpbXBsZUZvcm1CcmFuZGluZy5hZGRDb250ZW50KGljb24pOw0KICAgICAgICB9KQ0KICAgIH0sDQogICAgY3JlYXRlQ3NzU3RyaW5nOiBmdW5jdGlvbiAoY3NzQ2xhc3MsIGRhdGEsIGJyZWFrTGluZSkgew0KICAgICAgICBsZXQgY3JsZiA9ICIiOw0KICAgICAgICBpZiAoYnJlYWtMaW5lKSB7DQogICAgICAgICAgICBjcmxmID0gIiBcbiI7DQogICAgICAgIH0NCg0KICAgICAgICBsZXQgY3NzU3RyaW5nID0gIi4iICsgY3NzQ2xhc3MgKyAieyBiYWNrZ3JvdW5kLWNvbG9yOiAiICsgZGF0YS5wYWdlQkdDb2xvciArICIhaW1wb3J0YW50O30iICsgY3JsZjsgIC8vUGFnZSBiYWNrZ3JvdW5kDQogICAgICAgIGNzc1N0cmluZyArPSAiLiIgKyBjc3NDbGFzcyArICIgLnNhcE1IZWFkZXItQ1RYIHsgYmFja2dyb3VuZC1jb2xvcjogIiArIGRhdGEucGFnZUhlYWRlckJHQ29sb3IgKyAiIWltcG9ydGFudDt9IiArIGNybGY7IC8vIFBhZ2UgSGVhZGVyIGJhY2tncm91bmQNCiAgICAgICAgLy8gY3NzU3RyaW5nICs9ICIuIiArIGNzc0NsYXNzICsgIiAuLnNhcE1JQmFyLUNUWC5zYXBNVGl0bGV7IGNvbG9yOiAiICsgZGF0YS5wYWdlSGVhZGVyVGV4dENvbG9yICsgIiFpbXBvcnRhbnQ7fSIgKyBjcmxmOy8vIFBhZ2UgSGVhZGVyIHRleHQNCiAgICAgICAgY3NzU3RyaW5nICs9ICIuIiArIGNzc0NsYXNzICsgIiAuc2FwTVBhbmVsQ29udGVudHsgYmFja2dyb3VuZC1jb2xvcjogIiArIGRhdGEucGFuZWxCR0NvbG9yICsgIiFpbXBvcnRhbnQ7fSIgKyBjcmxmOyAvL1BhbmVsIGJhY2tncm91bmQNCiAgICAgICAgY3NzU3RyaW5nICs9ICIuIiArIGNzc0NsYXNzICsgIiAuc2FwTVBhbmVsSGRyeyBiYWNrZ3JvdW5kLWNvbG9yOiAiICsgZGF0YS5wYW5lbEhlYWRlckJHQ29sb3IgKyAiIWltcG9ydGFudDt9IiArIGNybGY7IC8vUGFuZWwgSGVhZGVyIGJhY2tncm91bmQNCiAgICAgICAgY3NzU3RyaW5nICs9ICIuIiArIGNzc0NsYXNzICsgIiAuc2FwRkNhcmR7IGJhY2tncm91bmQtY29sb3I6ICIgKyBkYXRhLmNhcmRCR0NvbG9yICsgIiFpbXBvcnRhbnQ7fSIgKyBjcmxmOyAvL2NhcmQgYmFja2dyb3VuZA0KICAgICAgICBjc3NTdHJpbmcgKz0gIi4iICsgY3NzQ2xhc3MgKyAiIC5zYXBNRm9vdGVyLUNUWCB7YmFja2dyb3VuZC1jb2xvcjogIiArIGRhdGEuYmFyRm9vdGVyQkdDb2xvciArICIgIWltcG9ydGFudDt9IiArIGNybGY7IC8vIFBhZ2VGb290ZXINCiAgICAgICAgY3NzU3RyaW5nICs9ICIuIiArIGNzc0NsYXNzICsgIiAuc2FwTUJ0bkRlZmF1bHQge2JhY2tncm91bmQtY29sb3I6ICIgKyBkYXRhLmJ1dHRvbkJHQ29sb3IgKyAifSIgKyBjcmxmOyAvLyBCdXR0b24gYmFja2d0b3VuZCANCg0KICAgICAgICAvLyBjc3NTdHJpbmcgKz0gIi4iICsgY3NzQ2xhc3MgKyAiIC5zYXBNQnRuRGVmYXVsdDpob3ZlciB7YmFja2dyb3VuZC1jb2xvcjogIiArIGRhdGEuYnV0dG9uQkdDb2xvckhvdXZlciArICIhaW1wb3J0YW50OyBmaWx0ZXI6IGJyaWdodG5lc3MoMTcwJSk7IH0iICsgY3JsZjsgLy8gQnV0dG9uIGJhY2tndG91bmQgDQogICAgICAgIC8vIGNzc1N0cmluZyArPSAiLiIgKyBjc3NDbGFzcyArICIgLnNhcE1UZXh0IHtjb2xvcjogIiArIGRhdGEudGV4dENvbG9yICsgIn0iICsgY3JsZjsgLy8gVGV4dA0KICAgICAgICAvLyAgY3NzU3RyaW5nICs9ICIuIiArIGNzc0NsYXNzICsgIiAuc2FwTVRpdGxlIHtjb2xvcjogIiArIGRhdGEudGV4dFRpdGxlQ29sb3IgKyAifSIgKyBjcmxmOyAvLyBUZXh0IFRpdGxlDQogICAgICAgIC8vIGNzc1N0cmluZyArPSAiLiIgKyBjc3NDbGFzcyArICIgLnNhcE1UZXh0LnNhcE1PYmpMVGl0bGUgIHtjb2xvcjogIiArIGRhdGEudGV4dFRpdGxlQ29sb3IgKyAifSIgKyBjcmxmOyAvLyBMaXN0IFRpdGxlDQogICAgICAgIC8vICBjc3NTdHJpbmcgKz0gIi4iICsgY3NzQ2xhc3MgKyAiIC5zYXBNVGV4dC5zYXBNT2JqTEludHJvICB7Y29sb3I6ICIgKyBkYXRhLnRleHRUaXRsZUNvbG9yICsgIn0iICsgY3JsZjsgLy8gTGlzdCBJbnRybw0KICAgICAgICAvLyAgY3NzU3RyaW5nICs9ICIuIiArIGNzc0NsYXNzICsgIiAuc2FwTVRleHQuc2FwTU9iakxJY29uICB7Y29sb3I6ICIgKyBkYXRhLnRleHRUaXRsZUNvbG9yICsgIn0iICsgY3JsZjsgLy8gTGlzdCBJY29uDQoNCiAgICAgICAgcmV0dXJuIGNzc1N0cmluZzsNCiAgICB9LA0KICAgIGFwcGx5Q3NzOiBmdW5jdGlvbiAoY3NzQ2xhc3MsIGRhdGEpIHsNCiAgICAgICAgbGV0IGNzcyA9IG5hYi5icmFuZGluZy5jcmVhdGVDc3NTdHJpbmcoY3NzQ2xhc3MsIGRhdGEpDQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNzc0NsYXNzKS5pbm5lckhUTUwgPSBjc3M7DQogICAgfSwNCiAgICBwcmV2aWV3Q3NzOiBmdW5jdGlvbiAoZGF0YSkgew0KICAgICAgICBuYWIuYnJhbmRpbmcuYXBwbHlDc3MoJ3ByZXZpZXdQYWdlJywgZGF0YSkNCiAgICB9LA0KICAgIGNsZWFyUHJldmlld0NzczogZnVuY3Rpb24gKCkgew0KICAgICAgICBuYWIuYnJhbmRpbmcuY2xlYXJDc3MoJ3ByZXZpZXdQYWdlJykNCiAgICB9LA0KICAgIGNsZWFyQ3NzOiBmdW5jdGlvbiAoY3NzQ2xhc3MpIHsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3NzQ2xhc3MpLmlubmVySFRNTCA9ICIiOw0KICAgIH0sDQogICAgYXBwbHlQYWdlQ3NzOiBmdW5jdGlvbiAoZGF0YSkgew0KICAgICAgICBuYWIuYnJhbmRpbmcuYXBwbHlDc3MoJ0FCUkJyYW5kaW5nJywgZGF0YSkNCiAgICB9LA0KICAgIGNsZWFyUGFnZUNzczogZnVuY3Rpb24gKCkgew0KICAgICAgICBuYWIuYnJhbmRpbmcuY2xlYXJDc3MoJ0FCUkJyYW5kaW5nJykNCiAgICB9LA0KICAgIGJ1aWxkVHJlZTogZnVuY3Rpb24gKGRhdGEpIHsNCg0KICAgICAgICBsZXQgdHJlZSA9IFtdOw0KICAgICAgICBsZXQgcm9vdFByZXNlbnQgPSBmYWxzZTsNCg0KICAgICAgICAkLmVhY2goZGF0YSwgZnVuY3Rpb24gKGksIGNzcykgew0KICAgICAgICAgICAgbGV0IGNvbnRlbnQgPSBjc3MubmFtZS5zcGxpdCgnLycpDQogICAgICAgICAgICBsZXQgZm9sZGVyID0ge307DQogICAgICAgICAgICBsZXQgbGFzdGZvbGRlciA9IHt9Ow0KICAgICAgICAgICAgbGV0IHBhdGggPSAiIjsNCiAgICAgICAgICAgIGxldCBlZGl0ID0gdHJ1ZTsNCiAgICAgICAgICAgICQuZWFjaChjb250ZW50LCBmdW5jdGlvbiAoaywgbmFtZSkgew0KDQogICAgICAgICAgICAgICAgaWYgKGsgPT09IGNvbnRlbnQubGVuZ3RoIC0gMSkgew0KICAgICAgICAgICAgICAgICAgICBmb2xkZXIuc3ViRm9sZGVyLnB1c2goew0KICAgICAgICAgICAgICAgICAgICAgICAgLi4uY3NzLA0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZVRyZWU6IG5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiY3NzIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsDQogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICBzdWJGb2xkZXI6IFtdLA0KDQogICAgICAgICAgICAgICAgICAgIH0pDQoNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBwYXRoID0gcGF0aCArIG5hbWUgKyAiLyI7DQogICAgICAgICAgICAgICAgICAgIGZvbGRlciA9IG5hYi5tZWRpYS5nZXRPYmplY3QodHJlZSwgcGF0aCk7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKGZvbGRlciA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb2xkZXIgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZVRyZWU6IG5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImZvbGRlciIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogcGF0aCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViRm9sZGVyOiBbXSwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGsgPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmFtZSA9PT0gIk1haW4iKSByb290UHJlc2VudCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09ICJOZXB0dW5lIikgZWRpdCA9IGRhdGEubmVwdHVuZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlLnB1c2goZm9sZGVyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Zm9sZGVyLnN1YkZvbGRlci5wdXNoKGZvbGRlcik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBsYXN0Zm9sZGVyID0gZm9sZGVyOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09ICJOZXB0dW5lIiAmJiBrID09PSAwKSBlZGl0ID0gZGF0YS5uZXB0dW5lOw0KICAgICAgICAgICAgICAgICAgICAgICAgbGFzdGZvbGRlciA9IGZvbGRlcjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgIH0pDQogICAgICAgIGlmICghcm9vdFByZXNlbnQpIHsNCiAgICAgICAgICAgIHRyZWUucHVzaCh7DQogICAgICAgICAgICAgICAgbmFtZVRyZWU6ICJNYWluIiwNCiAgICAgICAgICAgICAgICB0eXBlOiAiZm9sZGVyIiwNCiAgICAgICAgICAgICAgICAvLyAgZm9sZGVyOiAiTWFpbiIsDQogICAgICAgICAgICAgICAgLy9wYXRoOiBuYWIubWVkaWEuYWNjb3VudGlkICsgIi8iLA0KICAgICAgICAgICAgICAgIHBhdGg6ICJNYWluLyIsDQogICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlLA0KICAgICAgICAgICAgICAgIHN1YkZvbGRlcjogW10sDQogICAgICAgICAgICAgICAgLy9maWxlczogW10NCiAgICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgICAgbW9kZWxvVHJlZUJyYW5kaW5nLnNldERhdGEodHJlZSk7DQogICAgfSwNCiAgICBhZGROZXdGb2xkZXI6IGZ1bmN0aW9uIChmb2xkZXJOYW1lKSB7DQogICAgICAgIGxldCBvbGQgPSBvVHJlZUJyYW5kaW5nLmdldFNlbGVjdGVkSXRlbSgpOw0KICAgICAgICBuYWIuYnJhbmRpbmcuY3VycmVudEZvbGRlci5zdWJGb2xkZXIucHVzaCh7DQogICAgICAgICAgICAvL2ZvbGRlcjogZm9sZGVyTmFtZSwNCiAgICAgICAgICAgIG5hbWVUcmVlOiBmb2xkZXJOYW1lLA0KICAgICAgICAgICAgcGF0aDogbmFiLmJyYW5kaW5nLmN1cnJlbnRGb2xkZXIucGF0aCArIGZvbGRlck5hbWUgKyAiLyIsDQogICAgICAgICAgICBzZWxlY3RlZDogdHJ1ZSwNCiAgICAgICAgICAgIHN1YkZvbGRlcjogW10sDQogICAgICAgICAgICB0eXBlOiAiZm9sZGVyIiwNCiAgICAgICAgICAgIC8vIGZpbGVzOiBbXQ0KICAgICAgICB9KQ0KDQogICAgICAgIG1vZGVsb1RyZWVCcmFuZGluZy5yZWZyZXNoKCk7DQogICAgICAgIG9UcmVlQnJhbmRpbmcuZXhwYW5kKG9UcmVlQnJhbmRpbmcuaW5kZXhPZkl0ZW0ob2xkKSkNCiAgICAgICAgb1RyZWVCcmFuZGluZy5maXJlU2VsZWN0aW9uQ2hhbmdlKCk7DQogICAgICAgIG9UcmVlQnJhbmRpbmcuc2Nyb2xsVG9JbmRleChvVHJlZUJyYW5kaW5nLmluZGV4T2ZJdGVtKG9UcmVlQnJhbmRpbmcuZ2V0U2VsZWN0ZWRJdGVtKCkpKQ0KICAgIH0sDQogICAgc2V0U2NyZWVuTGF5b3V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgIGxheW91dERlZkJyYW5kaW5nTWlkbGUuc2V0U2l6ZSgiMzAwcHgiKTsNCiAgICAgICAgb1BhZ2VCcmFuZGluZ01lc3NhZ2Uuc2V0VmlzaWJsZShmYWxzZSk7DQogICAgICAgIG9QYW5lbEJyYW5kaW5nUHJldmlldy5zZXRWaXNpYmxlKHRydWUpOw0KICAgIH0sDQogICAgcmVzZXRTY3JlZW5MYXlvdXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgbGF5b3V0RGVmQnJhbmRpbmdNaWRsZS5zZXRTaXplKCIwcHgiKTsNCiAgICAgICAgb1BhZ2VCcmFuZGluZ01lc3NhZ2Uuc2V0VmlzaWJsZSh0cnVlKTsNCiAgICAgICAgb1BhbmVsQnJhbmRpbmdQcmV2aWV3LnNldFZpc2libGUoZmFsc2UpOw0KICAgICAgICBvVHJlZUJyYW5kaW5nLnJlbW92ZVNlbGVjdGlvbnMoKTsNCiAgICAgICAgb0J1dHRvbkJyYW5kaW5nU2F2ZS5zZXRFbmFibGVkKGZhbHNlKTsNCiAgICAgICAgb0lucHV0QnJhbmRpbmdOYW1lLnNldFZhbHVlU3RhdGUoIk5vbmUiKTsNCiAgICB9LA0KICAgIG5ld0JyYW5kaW5nOiBmdW5jdGlvbiAoc2VsZWN0ZWRJdGVtKSB7DQoNCiAgICAgICAgbGV0IGVtcHR5ZGF0YSA9IHsNCiAgICAgICAgICAgIG5hbWVUcmVlOiAiIiwNCiAgICAgICAgICAgIHR5cGU6ICJjc3MiLA0KICAgICAgICAgICAgcGF0aDogIiIsDQogICAgICAgICAgICBzZWxlY3RlZDogdHJ1ZSwNCiAgICAgICAgICAgIHN1YkZvbGRlcjogW10sDQogICAgICAgICAgICBDb2xvcnM6IHsNCiAgICAgICAgICAgICAgICBjb2xvcjE6ICIjZjZiMjIxIiwNCiAgICAgICAgICAgICAgICBjb2xvcjI6ICIjMDMzZTUyIiwNCiAgICAgICAgICAgICAgICBjb2xvcjM6ICIjODNjOGJjIiwNCiAgICAgICAgICAgICAgICBjb2xvcjQ6ICIjZmZmZmZmIiwNCiAgICAgICAgICAgICAgICBjb2xvcjU6ICIjZjNmNWY2Ig0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGFjY291bnRpZDogbW9kZWxBcHBEYXRhLm9EYXRhLmFjY291bnRpZCwNCiAgICAgICAgICAgIGNzczoge30sDQogICAgICAgICAgICBkZXNjcmlwdGlvbjogIiIsDQogICAgICAgICAgICBuYW1lOiAiIiwNCiAgICAgICAgICAgIHdoZXJlX3VzZWQ6IHt9DQogICAgICAgIH0NCiAgICAgICAgbGV0IGFycmF5ID0gW107DQogICAgICAgIGlmIChzZWxlY3RlZEl0ZW0pIHsNCiAgICAgICAgICAgIGxldCBkYXRhID0gc2VsZWN0ZWRJdGVtLmdldEJpbmRpbmdDb250ZXh0KCkuZ2V0T2JqZWN0KCk7DQogICAgICAgICAgICBlbXB0eWRhdGEucGF0aCA9IGRhdGEucGF0aDsNCg0KICAgICAgICAgICAgaWYgKHNlbGVjdGVkSXRlbS5nZXRCaW5kaW5nQ29udGV4dCgpLmdldFByb3BlcnR5KCJ0eXBlIikgPT09ICJmb2xkZXIiKSB7DQogICAgICAgICAgICAgICAgYXJyYXkgPSBtb2RlbG9UcmVlQnJhbmRpbmcuZ2V0Q29udGV4dChzZWxlY3RlZEl0ZW0uZ2V0QmluZGluZ0NvbnRleHQoKS5zUGF0aCkuZ2V0UHJvcGVydHkoInN1YkZvbGRlciIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBhcnJheSA9IG1vZGVsb1RyZWVCcmFuZGluZy5nZXRDb250ZXh0KHNlbGVjdGVkSXRlbS5nZXRCaW5kaW5nQ29udGV4dCgpLnNQYXRoLnNsaWNlKDAsIHNlbGVjdGVkSXRlbS5nZXRCaW5kaW5nQ29udGV4dCgpLnNQYXRoLmxhc3RJbmRleE9mKCcvJykpKS5nZXRPYmplY3QoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgZW1wdHlkYXRhLnBhdGggPSAiTWFpbi8iOw0KICAgICAgICAgICAgYXJyYXkgPSBtb2RlbG9UcmVlQnJhbmRpbmcuZ2V0Q29udGV4dCgiLzAvc3ViRm9sZGVyIikuZ2V0T2JqZWN0KCk7DQogICAgICAgIH0NCiAgICAgICAgb1RyZWVCcmFuZGluZy5yZW1vdmVTZWxlY3Rpb25zKCk7DQogICAgICAgIGFycmF5LnVuc2hpZnQoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlbXB0eWRhdGEpKSk7DQogICAgICAgIG1vZGVsb1RyZWVCcmFuZGluZy5yZWZyZXNoKCk7DQogICAgICAgIG9UcmVlQnJhbmRpbmcuZmlyZVNlbGVjdGlvbkNoYW5nZSgpOw0KICAgICAgICBuYWIuYnJhbmRpbmcuY2hhbmdlZCgpOw0KICAgIH0sDQogICAgcGFnZUNsaWNrOiBmdW5jdGlvbiAoZSkgew0KICAgICAgICBuYWIuYnJhbmRpbmcuc2VsZWN0ZWRPYmplY3RJc0FIZWFkZXIgPSBmYWxzZTsNCiAgICAgICAgaWYgKGUudGFyZ2V0LmlkLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoImhlYWRlciIpKSBuYWIuYnJhbmRpbmcuc2VsZWN0ZWRPYmplY3RJc0FIZWFkZXIgPSB0cnVlOw0KICAgICAgICBsZXQgb2JqTmFtZSA9IGUudGFyZ2V0LmlkLnNwbGl0KCItIilbMF07DQogICAgICAgIG5hYi5icmFuZGluZy5zZWxlY3RlZE9iamVjdCA9IHNhcC51aS5nZXRDb3JlKCkuYnlJZChvYmpOYW1lLnNwbGl0KCJfIilbMF0pDQoNCiAgICAgICAgLy8gc3dpdGNoIChuYWIuYnJhbmRpbmcuc2VsZWN0ZWRPYmplY3Quc0lkKSB7DQoNCiAgICAgICAgLy8gICBjYXNlICJib1BhZ2VQcmV2aWV3QnJhbmRpbmciOg0KICAgICAgICAvLyAgY2FzZSAiYm9QYW5lbCI6DQogICAgICAgIC8vICAgY2FzZSAiYm9DYXJkIjoNCiAgICAgICAgLy8gIGNhc2UgImJvQnV0dG9uIjoNCiAgICAgICAgLy8gIGNhc2UgImJvQmFyRm9vdGVycHJldmlldyI6DQoNCiAgICAgICAgb1JQb3BvdmVyQnJhbmRpbmdDb2xvci5vcGVuQnkobmFiLmJyYW5kaW5nLnNlbGVjdGVkT2JqZWN0KTsNCiAgICAgICAgLy8gICAgIGJyZWFrOw0KICAgICAgICAvLyAgZGVmYXVsdDoNCiAgICAgICAgLy8gIGNvbnNvbGUubG9nKGUudGFyZ2V0LmlkKQ0KICAgICAgICAvLyAgICAgYnJlYWs7DQoNCiAgICAgICAgLy8gfQ0KICAgIH0sDQogICAgcG9wdWxhdGVMaXN0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgIG1vZGVsb0xpc3RCcmFuZGluZ0NvbG9ycy5vRGF0YSA9IFtdOw0KDQogICAgICAgIGxldCBjb2xvcnMgPSBtb2RlbFBhbkNvbmZpZ0JyYW5kaW5nLm9EYXRhLkNvbG9yczsNCiAgICAgICAgbGV0IGxpc3RDb2xvciA9IHsNCiAgICAgICAgICAgIGNvbG9yMTAwOiAiIiwNCiAgICAgICAgICAgIGNvbG9yNzU6ICIiLA0KICAgICAgICAgICAgY29sb3I1MDogIiIsDQogICAgICAgICAgICBjb2xvcjI1OiAiIg0KICAgICAgICB9DQoNCiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoY29sb3JzKSkgew0KICAgICAgICAgICAgbGlzdENvbG9yLmNvbG9yMTAwID0gdmFsdWU7DQogICAgICAgICAgICBsaXN0Q29sb3IuY29sb3I3NSA9IHZhbHVlOy8vKyAiYmYiOw0KICAgICAgICAgICAgbGlzdENvbG9yLmNvbG9yNTAgPSB2YWx1ZTsvLysgIjgwIjsNCiAgICAgICAgICAgIGxpc3RDb2xvci5jb2xvcjI1ID0gdmFsdWU7Ly8rICI0MCI7DQogICAgICAgICAgICBtb2RlbG9MaXN0QnJhbmRpbmdDb2xvcnMub0RhdGEucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGxpc3RDb2xvcikpKTsNCg0KICAgICAgICB9DQogICAgICAgIG1vZGVsb0xpc3RCcmFuZGluZ0NvbG9ycy5yZWZyZXNoKCk7DQogICAgfSwNCiAgICBjb2xvclNlbGVjdGVkOiBmdW5jdGlvbiAob3BhY2l0eSwgY29sb3IpIHsNCiAgICAgICAgbGV0IGNzcyA9IG1vZGVsUGFuQ29uZmlnQnJhbmRpbmcuZ2V0RGF0YSgpLmNzcw0KICAgICAgICBsZXQgdHJhbnNwYXJlbmN5ID0gIiI7DQogICAgICAgIHN3aXRjaCAob3BhY2l0eSkgew0KICAgICAgICAgICAgY2FzZSAiMTAwIjoNCiAgICAgICAgICAgICAgICB0cmFuc3BhcmVuY3kgPSAiZmYiOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAiODAiOg0KICAgICAgICAgICAgICAgIHRyYW5zcGFyZW5jeSA9ICJjYyI7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICI2MCI6DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbmN5ID0gIjkwIjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgIjQwIjoNCiAgICAgICAgICAgICAgICB0cmFuc3BhcmVuY3kgPSAiNjYiOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICB0cmFuc3BhcmVuY3kgPSAiMDAiOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQoNCiAgICAgICAgc3dpdGNoIChuYWIuYnJhbmRpbmcuc2VsZWN0ZWRPYmplY3Quc0lkKSB7DQogICAgICAgICAgICBjYXNlICJib1BhZ2VQcmV2aWV3QnJhbmRpbmciOg0KICAgICAgICAgICAgICAgIGlmIChuYWIuYnJhbmRpbmcuc2VsZWN0ZWRPYmplY3RJc0FIZWFkZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgY3NzLnBhZ2VIZWFkZXJCR0NvbG9yID0gY29sb3IgKyB0cmFuc3BhcmVuY3k7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY3NzLnBhZ2VCR0NvbG9yID0gY29sb3IgKyB0cmFuc3BhcmVuY3k7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAiYm9QYW5lbCI6DQogICAgICAgICAgICAgICAgaWYgKG5hYi5icmFuZGluZy5zZWxlY3RlZE9iamVjdElzQUhlYWRlcikgew0KICAgICAgICAgICAgICAgICAgICBjc3MucGFuZWxIZWFkZXJCR0NvbG9yID0gY29sb3IgKyB0cmFuc3BhcmVuY3k7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY3NzLnBhbmVsQkdDb2xvciA9IGNvbG9yICsgdHJhbnNwYXJlbmN5Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgImJvQ2FyZCI6DQogICAgICAgICAgICAgICAgY3NzLmNhcmRCR0NvbG9yID0gY29sb3IgKyB0cmFuc3BhcmVuY3k7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICJib0J1dHRvbiI6DQogICAgICAgICAgICAgICAgY3NzLmJ1dHRvbkJHQ29sb3IgPSBjb2xvciArIHRyYW5zcGFyZW5jeTsNCiAgICAgICAgICAgICAgICBjc3MuYnV0dG9uQkdDb2xvckhvdXZlciA9IGNvbG9yICsgdHJhbnNwYXJlbmN5Ow0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAiYm9CYXJGb290ZXJwcmV2aWV3IjoNCiAgICAgICAgICAgICAgICBjc3MuYmFyRm9vdGVyQkdDb2xvciA9IGNvbG9yICsgdHJhbnNwYXJlbmN5Ow0KDQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KDQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgfQ0KICAgICAgICBuYWIuYnJhbmRpbmcucHJldmlld0Nzcyhjc3MpOw0KICAgICAgICBuYWIuYnJhbmRpbmcuY2hhbmdlZCgpOw0KICAgIH0sDQogICAgY2hhbmdlZDogZnVuY3Rpb24gKCkgew0KICAgICAgICBvQnV0dG9uQnJhbmRpbmdTYXZlLnNldEVuYWJsZWQodHJ1ZSk7DQogICAgfSwNCiAgICBzYXZlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIGlmIChvSW5wdXRCcmFuZGluZ05hbWUuZ2V0VmFsdWUoKSA9PT0gIiIpIHsNCiAgICAgICAgICAgIG9JbnB1dEJyYW5kaW5nTmFtZS5zZXRWYWx1ZVN0YXRlKCJFcnJvciIpOw0KICAgICAgICAgICAgc2FwLm0uTWVzc2FnZVRvYXN0LnNob3coIk5hbWUgaXMgZW1wdHkhISIpOw0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCg0KICAgICAgICBvQnV0dG9uQnJhbmRpbmdTYXZlLnNldEVuYWJsZWQoZmFsc2UpOw0KICAgICAgICBhcGlCcmFuZGluZ1NhdmUoeyBkYXRhOiBtb2RlbFBhbkNvbmZpZ0JyYW5kaW5nLm9EYXRhIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyAhPT0gJ0Vycm9yJykgew0KICAgICAgICAgICAgICAgIC8vIC8vIGRlYnVnZ2VyDQogICAgICAgICAgICAgICAgLy8gbW9kZWxQYW5Db25maWdCcmFuZGluZy5vRGF0YSA9IGRhdGE7DQogICAgICAgICAgICAgICAgbW9kZWxQYW5Db25maWdCcmFuZGluZy5vRGF0YSA9IHsgLi4ubW9kZWxQYW5Db25maWdCcmFuZGluZy5vRGF0YSwgaWQ6IGRhdGEuaWQsIHVwZGF0ZWRBdDogZGF0YS51cGRhdGVkQXQsIGNyZWF0ZWRBdDogZGF0YS51cGRhdGVkQXQsIGNyZWF0ZWRCeTogZGF0YS5jcmVhdGVkQnksIHVwZGF0ZWRCeTogZGF0YS51cGRhdGVkQnkgfTsNCg0KICAgICAgICAgICAgICAgIG1vZGVsUGFuQ29uZmlnQnJhbmRpbmcucmVmcmVzaCgpOw0KICAgICAgICAgICAgICAgIG1vZGVsb1RyZWVCcmFuZGluZy5yZWZyZXNoKCk7DQogICAgICAgICAgICAgICAgaWYgKGRhdGEudXNlZCkgew0KICAgICAgICAgICAgICAgICAgICBuYWIuYnJhbmRpbmcuYXBwbHlQYWdlQ3NzKGRhdGEuY3NzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0sDQogICAgY2hlY2tVbnNhdmVkRGF0YTogZnVuY3Rpb24gKCkgew0KICAgICAgICBpZiAob0J1dHRvbkJyYW5kaW5nU2F2ZS5nZXRFbmFibGVkKCkpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9LA0KICAgIHNlbGVjdGlvbkNoYW5nZWQ6IGZ1bmN0aW9uIChhY3RpdmUsIGRhdGEpIHsNCg0KICAgICAgICBpZiAobmFiLmJyYW5kaW5nLmNoZWNrVW5zYXZlZERhdGEoKSkgew0KICAgICAgICAgICAgZGF0YS51c2VkID0gZmFsc2U7DQogICAgICAgICAgICBtb2RlbG9UcmVlQnJhbmRpbmcucmVmcmVzaCgpOw0KICAgICAgICAgICAgbW9kZWxQYW5Db25maWdCcmFuZGluZy5yZWZyZXNoKCk7DQogICAgICAgICAgICBzYXAubS5NZXNzYWdlVG9hc3Quc2hvdygiU2F2ZSBvciBEaXNjYXJkIHRoZSBDaGFuZ2VzIGZpcnN0ISEiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBtb2RlbEJyYW5kaW5nLm9EYXRhKSB7DQogICAgICAgICAgICBpZiAobGluZS51c2VkICYmIGxpbmUuaWQgIT09IGRhdGEuaWQpIHsNCiAgICAgICAgICAgICAgICBsaW5lLnVzZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAobGluZS5pZCA9PT0gZGF0YS5pZCkgew0KICAgICAgICAgICAgICAgIGxpbmUudXNlZCA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgbW9kZWxCcmFuZGluZy5yZWZyZXNoKCk7DQoNCiAgICAgICAgaWYgKGFjdGl2ZSkgew0KICAgICAgICAgICAgbmFiLmJyYW5kaW5nLmFwcGx5UGFnZUNzcyhkYXRhLmNzcyk7DQogICAgICAgICAgICBuYWIuY3NzLmFkZE9yVXBkYXRlVG9BbGxQYWdlcygiQUJSQnJhbmRpbmciLCAiIiwgIiIsIGRhdGEuaWQpOw0KDQogICAgICAgICAgICBzYXAubS5NZXNzYWdlVG9hc3Quc2hvdygiQnJhbmRpbmcgYXBwbGllZCEhIik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBuYWIuYnJhbmRpbmcuY2xlYXJQYWdlQ3NzKCk7DQogICAgICAgICAgICBuYWIuY3NzLnJlbW92ZUZyb21BbGxQYWdlcygiQUJSQnJhbmRpbmciLCAiIiwgIiIsIGRhdGEuaWQpOw0KDQogICAgICAgICAgICBzYXAubS5NZXNzYWdlVG9hc3Quc2hvdygiQnJhbmRpbmcgcmVtb3ZlZCEhIik7DQogICAgICAgIH0NCiAgICAgICAgbmFiLmJyYW5kaW5nLnByb2Nlc3NpbmdEYXRhKG1vZGVsQnJhbmRpbmcub0RhdGEpOw0KICAgICAgICBuYWIuYnJhbmRpbmcuZ2VuZXJhdGVTY3JlZW5BbGxQYWdlcygpOw0KICAgIH0sDQogICAgZ2VuZXJhdGVTY3JlZW5BbGxQYWdlczogZnVuY3Rpb24gKCkgew0KICAgICAgICBpZiAobW9kZWxBcHBEYXRhLm9EYXRhLnBhZ2VzLmxlbmd0aCA9PT0gdW5kZWZpbmVkKSByZXR1cm47DQogICAgICAgIGxldCBjdXJyZW50ZVBhZ2UgPSBCdWlsZGVyLmdldFNlbGVjdGVkUGFnZUlkKCk7DQoNCiAgICAgICAgbGV0IGkgPSAwOw0KDQogICAgICAgIHZhciBteUludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgaWYgKGkgPCBtb2RlbEFwcERhdGEub0RhdGEucGFnZXMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgbGV0IHBhZ2UgPSBtb2RlbEFwcERhdGEub0RhdGEucGFnZXNbaV0NCiAgICAgICAgICAgICAgICBwYWdlLmltYWdlID0gbW9kZWxNYXN0ZXJEYXRhLm9EYXRhLnVybCArIG1vZGVsQXBwRGF0YS5vRGF0YS5hY2NvdW50aWQgKyAiLyIgKyBtb2RlbEFwcERhdGEub0RhdGEuaWQgKyAiLyIgKyBwYWdlLmlkOw0KICAgICAgICAgICAgICAgIEJ1aWxkZXIuc2VsZWN0UGFnZShwYWdlLmlkKTsNCiAgICAgICAgICAgICAgICBCdWlsZGVyLmNyZWF0ZVBhZ2VJbWFnZShwYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGkrKzsNCg0KDQogICAgICAgICAgICBpZiAoaSA+IG1vZGVsQXBwRGF0YS5vRGF0YS5wYWdlcy5sZW5ndGgpIHsNCg0KICAgICAgICAgICAgICAgIEJ1aWxkZXIuc2VsZWN0UGFnZShjdXJyZW50ZVBhZ2UpOw0KICAgICAgICAgICAgICAgIEJ1aWxkZXIuc2V0QXR0cmlidXRlcygpOw0KICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKG15SW50ZXJ2YWwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LCAzNTAwKTsNCiAgICB9DQp9